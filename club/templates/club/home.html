{% extends 'club/base.html' %}

{% block title %}Home - Costa Brava Bikers{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Hero Section -->
    <div class="bg-gradient-to-r from-blue-600 to-blue-800 rounded-lg shadow-xl p-8 text-white mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-4xl font-bold mb-4">Welcome to Costa Brava Bikers</h1>
                <p class="text-xl">Join us for epic rides along the beautiful Costa Brava</p>
            </div>
            {% if not user.is_authenticated %}
            <a href="{% url 'club:login' %}" class="bg-white text-blue-800 hover:bg-gray-100 px-8 py-4 rounded-lg text-lg font-medium flex items-center space-x-2">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m0 0l4 4m0 0l-4 4m6-4h-14m14 0h-3"></path>
                </svg>
                <span>Login</span>
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Upcoming Ride Section -->
    <div x-data="upcomingRide()" x-init="fetchUpcomingRide()" class="mb-8">
        <h2 class="text-3xl font-bold mb-4 text-gray-800">Next Ride</h2>
        
        <div x-show="loading" class="bg-white rounded-lg shadow-md p-8 text-center">
            <p class="text-gray-600">Loading...</p>
        </div>
        
        <div x-show="!loading && !ride" class="bg-white rounded-lg shadow-md p-8 text-center">
            <p class="text-gray-600">No upcoming rides scheduled yet.</p>
        </div>
        
        <div x-show="!loading && ride" class="bg-white rounded-lg shadow-md overflow-hidden">
            <template x-if="ride && ride.header_photo">
                <img :src="ride.header_photo" alt="Ride Header" class="w-full h-80 object-cover">
            </template>
            
            <div class="p-6">
                <h3 class="text-2xl font-bold mb-2" x-text="ride?.title"></h3>
                <div class="flex items-center text-gray-600 mb-4 space-x-4">
                    <span>üìÖ <span x-text="formatDate(ride?.date_time)"></span></span>
                    <span>üìç <span x-text="ride?.start_point"></span></span>
                </div>
                <p class="text-gray-700 mb-4" x-text="ride?.description"></p>
                
                <div class="flex flex-wrap gap-4">
                    <template x-if="ride && ride.calimoto_url">
                        <a :href="ride.calimoto_url" target="_blank" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">
                            View on Calimoto
                        </a>
                    </template>
                    <template x-if="ride && ride.relive_url">
                        <a :href="ride.relive_url" target="_blank" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md">
                            View on Relive
                        </a>
                    </template>
                    <a href="{% url 'club:upcoming_ride' %}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                        View Full Details
                    </a>
                </div>
                
                <div class="mt-4 pt-4 border-t">
                    <p class="text-gray-600">
                        <span class="font-semibold" x-text="ride?.riders?.length || 0"></span> riders going
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Vote Section -->
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-lg shadow-md">
        <h3 class="text-xl font-bold mb-2">üó≥Ô∏è Vote for the Next Ride</h3>
        <p class="text-gray-700 mb-4">Help us choose where to go next!</p>
        <a href="{% url 'club:poll_list' %}" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-md inline-block">
            Vote Now
        </a>
    </div>

    <!-- Quick Links -->
    <div class="grid md:grid-cols-3 gap-6 mt-8">
        <a href="{% url 'club:rides_list' %}" class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
            <h3 class="text-xl font-bold mb-2">üõ£Ô∏è Browse Rides</h3>
            <p class="text-gray-600">View all past and upcoming rides</p>
        </a>
        <a href="{% url 'club:members_list' %}" class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
            <h3 class="text-xl font-bold mb-2">üë• Members</h3>
            <p class="text-gray-600">See who's in the club</p>
        </a>
        <a href="{% url 'club:profile_edit' %}" class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
            <h3 class="text-xl font-bold mb-2">‚öôÔ∏è Profile</h3>
            <p class="text-gray-600">Update your profile and bikes</p>
        </a>
    </div>
</div>

<script>
    function upcomingRide() {
        return {
            ride: null,
            loading: true,
            
            async fetchUpcomingRide() {
                try {
                    const response = await fetch('/club/api/rides/upcoming/');
                    if (response.ok) {
                        this.ride = await response.json();
                    }
                } catch (error) {
                    console.error('Error fetching upcoming ride:', error);
                } finally {
                    this.loading = false;
                }
            },
            
            formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }
    }
</script>
{% endblock %}
